<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Directory</title>
    <style>
	
		.pagination {
		display:flex;
		justify-content:center;
		flex-wrap:wrap;
		gap:8px;
	}

	.page-btn {
		padding:8px 14px;
		border:none;
		border-radius:8px;
		background:#e2e8f0;
		cursor:pointer;
		transition: all 0.25s ease;
	}

	.page-btn:hover {
		transform: translateY(-3px) scale(1.08);
		background:#cbd5f5;
	}

	.page-btn.active {
		background:#475569;
		color:white;
		transform: scale(1.15);
	}

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            padding: 40px 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        h1 {
            color: #f8fafc;
            font-size: 2.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .shortlist-filter-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .shortlist-filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
        }
        
        .shortlist-filter-btn.active {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }
        
        .shortlist-count {
            background: white;
            color: #f59e0b;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .controls-section {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
        }
        
        .search-container {
            margin-bottom: 25px;
        }
        
        .search-container label {
            display: block;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .search-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 1em;
            border: 2px solid #cbd5e1;
            border-radius: 12px;
            transition: all 0.3s ease;
            background: white;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #64748b;
            box-shadow: 0 0 0 3px rgba(100, 116, 139, 0.1);
        }
        
        .sort-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .sort-container label {
            font-weight: 600;
            color: #1e293b;
            font-size: 1.1em;
        }
        
        .sort-button {
            padding: 12px 25px;
            font-size: 1em;
            font-weight: 600;
            border: 2px solid #64748b;
            background: white;
            color: #64748b;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .sort-button:hover {
            background: #64748b;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(100, 116, 139, 0.3);
        }
        
        .sort-button.active {
            background: linear-gradient(135deg, #475569 0%, #64748b 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(100, 116, 139, 0.4);
        }
        
        .profiles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 30px;
        }
        
        .profile-card {
            background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            transition: all 0.4s ease;
            border: 1px solid rgba(255,255,255,0.8);
            position: relative;
        }
        
        .profile-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
        }
        
        .shortlist-badge {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5em;
            transition: all 0.3s ease;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
            margin-left: 10px;
            vertical-align: middle;
            padding: 0;
        }
        
        .shortlist-badge:hover {
            transform: scale(1.2) rotate(15deg);
        }
        
        .shortlist-badge.active {
            animation: starPulse 0.5s ease;
        }
        
        @keyframes starPulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.3) rotate(180deg); }
        }
        
        .profile-image-container {
            width: 100%;
            height: 400px;
            overflow: hidden;
            background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
            position: relative;
        }
        
        .profile-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center top;
        }
        
        .profile-content {
            padding: 25px;
        }
        
        .profile-header {
            border-bottom: 3px solid transparent;
            border-image: linear-gradient(90deg, #64748b, #94a3b8) 1;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        
        .profile-name {
            font-size: 1.5em;
            color: #1e293b;
            margin-bottom: 5px;
            text-transform: capitalize;
            font-weight: 700;
        }
        
        .profile-id {
            background: linear-gradient(135deg, #475569 0%, #64748b 100%);
            color: white;
            font-weight: bold;
            font-size: 0.9em;
            padding: 5px 12px;
            border-radius: 20px;
            display: inline-block;
        }
        
        .profile-details {
            display: grid;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .detail-row {
            display: flex;
            padding: 8px 0;
            gap: 10px;
        }
        
        .detail-label {
            font-weight: 600;
            color: #475569;
            min-width: 120px;
            flex-shrink: 0;
        }
        
        .detail-value {
            color: #1f2937;
            font-weight: 500;
        }
        
        .profile-description {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            color: #475569;
            line-height: 1.6;
            font-size: 0.95em;
            border-left: 4px solid #64748b;
        }
        
        .profile-description a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: 600;
        }
        
        .profile-description a:hover {
            text-decoration: underline;
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .view-photo-btn, .view-contact-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #475569 0%, #64748b 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.05em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(71, 85, 105, 0.3);
            letter-spacing: 0.5px;
        }
        
        .view-photo-btn:hover, .view-contact-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(71, 85, 105, 0.4);
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
        }
        
        .view-contact-btn {
            background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%);
            box-shadow: 0 5px 15px rgba(8, 145, 178, 0.3);
        }
        
        .view-contact-btn:hover {
            background: linear-gradient(135deg, #0e7490 0%, #155e75 100%);
            box-shadow: 0 8px 20px rgba(8, 145, 178, 0.4);
        }
        
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: white;
            font-size: 1.3em;
            grid-column: 1 / -1;
        }
        
        @media (max-width: 768px) {
            .profiles-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .header-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .sort-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .sort-button {
                width: 100%;
            }
            
            .button-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <h1>Profile Directory</h1>
            <button id="shortlistToggleBtn" class="shortlist-filter-btn" onclick="toggleShortlistFilter()">
                <span id="filterBtnText">Show Shortlisted</span>
                <span class="shortlist-count" id="shortlistCount">0</span>
            </button>
        </div>
        
        <div class="controls-section">
            <div class="search-container">
                <label for="searchInput">Search by Name or Location</label>
                <input 
                    type="text" 
                    id="searchInput" 
                    class="search-input" 
                    placeholder="Type to search..."
                    onkeyup="searchProfiles()"
                >
            </div>
			
            <!--<div class="search-container">
				<label style="margin-left:10px;">Page size:
				<select id="pageSizeSelector" onchange="changePageSize()">
				<option value="6">6</option>
				<option value="12">12</option>
				<option value="24">24</option>
				</select>
				</label>
			</div>-->
			
            <div class="sort-container">
                <label>Sort By:</label>
                <button class="sort-button" onclick="sortProfiles('name')">Name</button>
                <button class="sort-button" onclick="sortProfiles('location')">Location</button>
                <button class="sort-button" onclick="sortProfiles('dob')">Date of Birth</button>
                <button class="sort-button" onclick="sortProfiles('height')">Height</button>
            </div>
        </div>
		<div id="paginationContainer" style="margin-top:40px; text-align:center;"></div>
        <div id="resultsInfo" style="margin:10px 0;font-weight:600;"></div>
        <div class="profiles-grid" id="profilesGrid"></div>
		<!--<div id="paginationContainer" style="margin-top:40px; text-align:center;"></div>-->

    </div>
    
    <!-- <script src="profiles_data.js"></script> -->
    <script>
        // Profile data is loaded from profiles_data.js
		let currentPage = 1;
		let profilesPerPage = 5; // Change this to 4, 8, etc.

        let currentProfiles = [];
        let showingShortlisted = false;
		let showShortlistOnly = false;
		
		let shortlist = JSON.parse(
			localStorage.getItem("profileShortlist") || "[]"
		);

        const profilesData = [
  {
    "name": "CA DEVANSHI AJAY DOSHI",
    "dob": "8/30/1996",
    "height": "5ft 2in",
    "religion": "Jain",
    "caste": "Swetambar",
	"image": "https://www.saptpadi.in/photos/watermark.php?image=1770797690-1.jpg&watermark=watermark.png",
    "photoAlbum": "https://www.saptpadi.in/view_photo_album?matri_id=SPTPD4311",
    "fullProfile": "https://www.saptpadi.in/memberFullProfile?user_id=SPTPD4311",
    "location": "Mulund, Maharashtra, India",
    "education": "B Com, CA",
    "occupation": "JOB",
    "subCaste": "",
    "aboutMe": "Education- CA, B.COM Occupation- Associate with reputed CA firm in Vapi...Read More",
    "id": "SPTPD4311",
    "contact": "https://www.saptpadi.in/web-services/contact_detail?toid=SPTPD4310"
  },
  {
    "name": "JAGRUTI VASANTBHAI THAKKAR",
    "dob": "9/22/1996",
    "height": "5ft 4in",
    "religion": "Hindu",
    "caste": "Gujarati",
    "image": "https://www.saptpadi.in/photos/watermark.php?image=1770468495-1.jpg&watermark=watermark.png",
    "photoAlbum": "https://www.saptpadi.in/view_photo_album?matri_id=SPTPD4310",
    "fullProfile": "https://www.saptpadi.in/memberFullProfile?user_id=SPTPD4310",
    "location": "Mulund, Maharashtra, India",
    "education": "CA",
    "occupation": "Manager",
    "subCaste": "Lohana",
    "aboutMe": "EDUCATION- CAOCCUPATION- MNAGER AT MORGAN STANLE...Read More",
    "id": "SPTPD4310",
    "contact": "https://www.saptpadi.in/web-services/contact_detail?toid=SPTPD4310"
  },
  {
    "name": "AVNI AMITBHAI DESAI",
    "dob": "9/20/1997",
    "height": "5ft 5in",
    "religion": "Hindu",
    "caste": "Gujarati",
    "image": "https://www.saptpadi.in/photos/watermark.php?image=1770195563-1.jpg&watermark=watermark.png",
    "photoAlbum": "https://www.saptpadi.in/view_photo_album?matri_id=SPTPD4305",
    "fullProfile": "https://www.saptpadi.in/memberFullProfile?user_id=SPTPD4305",
    "location": "Kandivli, Maharashtra, India",
    "education": "BA",
    "occupation": "Business",
    "subCaste": "Vaishnav",
    "aboutMe": "EDUCATION- BA IN FASHIONOCCUPATION- FOUNDER- GRE...Read More",
    "id": "SPTPD4305",
    "contact": "https://www.saptpadi.in/web-services/contact_detail?toid=SPTPD4305"
  },
  {
    "name": "KAVINA AMRISHBHAI BAVISI",
    "dob": "12/9/1995",
    "height": "5ft 0in",
    "religion": "Jain",
    "caste": "Gujarati",
    "image": "https://www.saptpadi.in/photos/watermark.php?image=1770036486-1.jpg&watermark=watermark.png",
    "photoAlbum": "https://www.saptpadi.in/view_photo_album?matri_id=SPTPD4298",
    "fullProfile": "https://www.saptpadi.in/memberFullProfile?user_id=SPTPD4298",
    "location": "Ahmadabad, Gujarat, India",
    "education": "PGD",
    "occupation": "Freelance",
    "subCaste": "Dasa Shrimadi Jain",
    "aboutMe": "EDUCATION- PG IN MAREKTING, ADVERTISING AND COMMUN...Read More",
    "id": "SPTPD4298",
    "contact": "https://www.saptpadi.in/web-services/contact_detail?toid=SPTPD4298"
  },
  {
    "name": "Karishma Sanghvi",
    "dob": "5/6/1992",
    "height": "5ft 3in",
    "religion": "Jain",
    "caste": "Gujarati",
    "image": "https://www.saptpadi.in/photos/watermark.php?image=1612973268.jpg&watermark=watermark.png",
    "photoAlbum": "https://www.saptpadi.in/view_photo_album?matri_id=SPTPD105",
    "fullProfile": "https://www.saptpadi.in/memberFullProfile?user_id=SPTPD105",
    "location": "Mumbai, Maharashtra, India",
    "education": "B Com",
    "occupation": "Others",
    "subCaste": "Swetambar",
    "aboutMe": "I have completed my graduation from K.J. Somaiya C...Read More",
    "id": "SPTPD105",
    "contact": "https://www.saptpadi.in/web-services/contact_detail?toid=SPTPD105"
  }
];

		function updateURLState() {
			const params = new URLSearchParams();

			params.set('page', currentPage);
			params.set('size', profilesPerPage);

			history.replaceState(null, '', '?' + params.toString());
		}

		function restoreStateFromURL() {
			const params = new URLSearchParams(window.location.search);

			currentPage = parseInt(params.get('page')) || 1;
			profilesPerPage = parseInt(params.get('size')) || 6;

			const selector = document.getElementById('pageSizeSelector');
			if (selector) selector.value = profilesPerPage;
		}

		function changePageSize() {
			profilesPerPage =
				parseInt(document.getElementById('pageSizeSelector').value);

			currentPage = 1;
			updateURLState();
			renderProfiles(currentProfiles);
		}

		function changePage(page) {
			currentPage = page;
			updateURLState();

			document.getElementById('profilesGrid')
				.scrollIntoView({behavior:"smooth"});

			renderProfiles(currentProfiles);
		}

        // Function to calculate age
        function calculateAge(dobString) {
            const dob = new Date(dobString);
            const today = new Date();
            let age = today.getFullYear() - dob.getFullYear();
            const monthDiff = today.getMonth() - dob.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
                age--;
            }
            
            return age;
        }
        
        // Function to format date from MM/DD/YYYY to DD Month YYYY
        function formatDate(dateString) {
            const date = new Date(dateString);
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                          'July', 'August', 'September', 'October', 'November', 'December'];
            
            const day = date.getDate();
            const month = months[date.getMonth()];
            const year = date.getFullYear();
            
            return `${day} ${month} ${year}`;
        }
        
        // Function to parse height for sorting
        function parseHeight(heightStr) {
            const match = heightStr.match(/(\d+)ft\s*(\d+)in/);
            if (match) {
                return parseInt(match[1]) * 12 + parseInt(match[2]);
            }
            return 0;
        }
        
        // Function to parse date for sorting
        function parseDate(dateStr) {
            return new Date(dateStr);
        }
        
        // Function to process "About Me" text and add Read More link
        function processAboutMe(aboutText, fullProfileUrl) {
            if (!aboutText) return '';
            
            // Replace "Read More" or "...Read More" with a link
            const linkText = '<a href="' + fullProfileUrl + '" target="_blank">Read More</a>';
            return aboutText.replace(/\.\.\.Read More|Read More/gi, linkText);
        }
        
        // Storage management - works on iPhone Safari
        let shortlistData = [];
        
        // Check if localStorage is available and working
        function isLocalStorageAvailable() {
            try {
                const test = '__localStorage_test__';
                localStorage.setItem(test, test);
                localStorage.removeItem(test);
                return true;
            } catch (e) {
                return false;
            }
        }
        
        // Initialize storage
        const useLocalStorage = isLocalStorageAvailable();
        
        // Get shortlist from storage or memory
        function getShortlist() {
            if (useLocalStorage) {
                try {
                    const shortlist = localStorage.getItem('profileShortlist');
                    return shortlist ? JSON.parse(shortlist) : [];
                } catch (e) {
                    console.warn('localStorage read failed, using memory:', e);
                    return shortlistData;
                }
            } else {
                return shortlistData;
            }
        }
        
        // Save shortlist to storage or memory
        function saveShortlist(shortlist) {
            if (useLocalStorage) {
                try {
                    localStorage.setItem('profileShortlist', JSON.stringify(shortlist));
                } catch (e) {
                    console.warn('localStorage save failed, using memory:', e);
                    shortlistData = shortlist;
                }
            } else {
                shortlistData = shortlist;
            }
            updateShortlistCount();
        }
        
        // Toggle shortlist status
        function toggleShortlist(profileId) {
            let shortlist = getShortlist();
            const index = shortlist.indexOf(profileId);
            
            if (index > -1) {
                shortlist.splice(index, 1);
            } else {
                shortlist.push(profileId);
            }
            
            saveShortlist(shortlist);
            
            // Update the star icon
            const starBtn = document.querySelector(`[data-profile-id="${profileId}"]`);
            if (starBtn) {
                starBtn.textContent = shortlist.includes(profileId) ? '⭐' : '☆';
                starBtn.classList.add('active');
                setTimeout(() => starBtn.classList.remove('active'), 500);
            }
        }
        
        // Check if profile is shortlisted
        function isShortlisted(profileId) {
            return getShortlist().includes(profileId);
        }
        
        function updateShortlistCount() {

			const el = document.getElementById("shortlistCount");

			if (!el) return; // prevents crashes if DOM changes

			const currentShortlist = getShortlist();
			el.textContent = currentShortlist.length;
		}

        
        function toggleShortlistFilter() {

			showShortlistOnly = !showShortlistOnly;

			const textElement = document.getElementById('filterBtnText');
			if (textElement) {
				textElement.textContent = showShortlistOnly
					? "Show All Profiles"
					: "Show Shortlisted";
			}

			rebuildProfilesView();
		}

        
        // Function to render profiles
        function renderProfiles(profiles) {
			const grid = document.getElementById('profilesGrid');
			const paginationContainer = document.getElementById('paginationContainer');

			if (profiles.length === 0) {
				grid.innerHTML = '<div class="no-results">No profiles found matching your criteria.</div>';
				paginationContainer.innerHTML = '';
				return;
			}

			const totalPages = Math.ceil(profiles.length / profilesPerPage);

			// Ensure currentPage stays valid
			if (currentPage > totalPages) {
				currentPage = 1;
			}

			const startIndex = (currentPage - 1) * profilesPerPage;
			const endIndex = startIndex + profilesPerPage;
			const paginatedProfiles = profiles.slice(startIndex, endIndex);

			const info = document.getElementById('resultsInfo');
			const startDisplay = profiles.length === 0 ? 0 : startIndex + 1;
			const endDisplay = Math.min(endIndex, profiles.length);

			info.innerText =
				`Showing ${startDisplay}-${endDisplay} of ${profiles.length} profiles`;

			grid.innerHTML = paginatedProfiles.map(profile => {
				const age = calculateAge(profile.dob);
				const formattedDob = formatDate(profile.dob);
				const aboutMeWithLink = processAboutMe(profile.aboutMe, profile.fullProfile);
				const isInShortlist = isShortlisted(profile.id);

				return `
				<div class="profile-card">
                    <div class="profile-image-container">
                        <img src="${profile.image}" 
                             alt="${profile.name}" 
                             class="profile-image"
                             onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22400%22%3E%3Crect fill=%22%23ddd%22 width=%22400%22 height=%22400%22/%3E%3Ctext fill=%22%23999%22 font-family=%22sans-serif%22 font-size=%2224%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22%3ENo Image%3C/text%3E%3C/svg%3E'">
                    </div>
                    <div class="profile-content">
                        <div class="profile-header">
                            <div class="profile-header-row">
                                <h2 class="profile-name">${profile.name}</h2>
                                <div class="profile-id-container">
                                    <div class="profile-id">${profile.id}</div>
                                    <button class="shortlist-badge" 
                                            data-profile-id="${profile.id}" 
                                            onclick="toggleShortlist('${profile.id}')"
                                            title="${isInShortlist ? 'Remove from shortlist' : 'Add to shortlist'}">
                                        ${isInShortlist ? '⭐' : '☆'}
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-details">
                            <div class="detail-row">
                                <span class="detail-label">Date of Birth:</span>
                                <span class="detail-value">${formattedDob}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Age:</span>
                                <span class="detail-value">${age} years</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Height:</span>
                                <span class="detail-value">${profile.height}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Religion:</span>
                                <span class="detail-value">${profile.religion}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Caste:</span>
                                <span class="detail-value">${profile.caste}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Sub-Caste:</span>
                                <span class="detail-value">${profile.subCaste}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Location:</span>
                                <span class="detail-value">${profile.location}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Education:</span>
                                <span class="detail-value">${profile.education}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Occupation:</span>
                                <span class="detail-value">${profile.occupation}</span>
                            </div>
                        </div>
                        
                        <div class="profile-description">
                            ${aboutMeWithLink}
                        </div>
                        
                        <div class="button-group">
                            <button class="view-photo-btn" onclick="viewPhoto('${profile.photoAlbum}')">
                                VIEW PHOTO
                            </button>
                            <button class="view-contact-btn" onclick="viewContact('${profile.contact}')">
                                VIEW CONTACT
                            </button>
                        </div>
                    </div>
                </div>
            `}).join('');
			
			renderPagination(totalPages);
		}
        
		function applyDefaultSorting() {
			currentProfiles = [...profilesData].sort((a, b) => {
				return new Date(a.dob) - new Date(b.dob); 
				// Older first. Flip sign if you want younger first.
			});
		}

		function sortByDOB(profiles) {
			return [...profiles].sort((a, b) =>
				new Date(a.dob) - new Date(b.dob)
			);
		}

		function renderPagination(totalPages) {
			const container = document.getElementById('paginationContainer');

			if (totalPages <= 1) {
				container.innerHTML = '';
				return;
			}

			const delta = 2; // pages around current page
			const range = [];
			const rangeWithDots = [];

			// Always include first and last
			for (let i = 1; i <= totalPages; i++) {
				if (
					i === 1 ||
					i === totalPages ||
					(i >= currentPage - delta && i <= currentPage + delta)
				) {
					range.push(i);
				}
			}

			// Inject dots
			let prev;
			for (let i of range) {
				if (prev) {
					if (i - prev === 2) {
						rangeWithDots.push(prev + 1);
					} else if (i - prev > 2) {
						rangeWithDots.push("...");
					}
				}
				rangeWithDots.push(i);
				prev = i;
			}

			let html = `<div class="pagination">`;

			if (currentPage > 1) {
				html += `<button class="page-btn" onclick="changePage(${currentPage-1})">Prev</button>`;
			}

			rangeWithDots.forEach(p => {
				if (p === "...") {
					html += `<span style="padding:8px 6px;">…</span>`;
				} else {
					html += `
						<button class="page-btn ${p===currentPage?'active':''}"
							onclick="changePage(${p})">${p}</button>
					`;
				}
			});

			if (currentPage < totalPages) {
				html += `<button class="page-btn" onclick="changePage(${currentPage+1})">Next</button>`;
			}

			html += `</div>`;
			container.innerHTML = html;
		}


		
		function changePage(page) {
			currentPage = page;
			renderProfiles(currentProfiles);
		}

		function rebuildProfilesView() {

			let base = [...profilesData];

			// Apply shortlist filter
			if (showShortlistOnly) {
				const currentShortlist = getShortlist();
				base = base.filter(p => currentShortlist.includes(p.id));
			}

			// Apply search filter
			const searchText =
				document.getElementById('searchInput').value
					.toLowerCase()
					.trim();

			if (searchText.length > 0) {
				base = base.filter(profile =>
					profile.name.toLowerCase().includes(searchText) ||
					profile.location.toLowerCase().includes(searchText) ||
					profile.id.toLowerCase().includes(searchText)
				);
			}

			// Always apply default sort
			currentProfiles = sortByDOB(base);

			currentPage = 1;
			updateURLState();
			renderProfiles(currentProfiles);
		}


        // Function to search profiles
        function searchProfiles() {
			rebuildProfilesView();
		}

        
        // Function to sort profiles
        function sortProfiles(sortBy) {
            // Remove active class from all buttons
            document.querySelectorAll('.sort-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            const sorted = [...currentProfiles];
            
            switch(sortBy) {
                case 'name':
                    sorted.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'location':
                    sorted.sort((a, b) => a.location.localeCompare(b.location));
                    break;
                case 'dob':
                    sorted.sort((a, b) => parseDate(a.dob) - parseDate(b.dob));
                    break;
                case 'height':
                    sorted.sort((a, b) => parseHeight(b.height) - parseHeight(a.height));
                    break;
            }
            
            currentProfiles = sorted;
			currentPage = 1;
			renderProfiles(currentProfiles);
        }
        
        // Function to view photo album
        function viewPhoto(photoAlbumUrl) {
            window.open(photoAlbumUrl, '_blank');
        }
        
        // Function to view contact
        function viewContact(contactUrl) {
            window.open(contactUrl, '_blank');
        }
        
        // Initialize when page loads
        window.onload = function() {
			currentProfiles = sortByDOB(profilesData);

			restoreStateFromURL();
			renderProfiles(currentProfiles);

            updateShortlistCount();
            
            // Show storage status notification (helpful for debugging)
            if (!useLocalStorage) {
                console.warn('⚠️ localStorage not available. Shortlist will only persist during this session.');
                // Optional: Show a brief notification to user
                showStorageNotification();
            }
			rebuildProfilesView();
        };
        
        // Show notification if localStorage is not working
        function showStorageNotification() {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
                color: white;
                padding: 15px 25px;
                border-radius: 12px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                z-index: 10000;
                font-size: 14px;
                max-width: 300px;
                animation: slideIn 0.3s ease-out;
            `;
            notification.innerHTML = `
                <strong>ℹ️ Note:</strong> Your shortlist will be saved only during this browsing session. 
                <br><small>To save permanently, enable cookies/storage in Safari settings.</small>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 8 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => notification.remove(), 300);
            }, 8000);
        }
    </script>
    <style>
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
    </style>
</body>
</html>
